# A病院 採血患者数予測UI スクリプト 解説

対応ノートブック: `A病院用 予測アプリ.ipynb`  
対応Pythonスクリプト: `a_hospital_prediction_app.py`

このファイルは、A病院向けの **日次予測／5営業日予測／時間帯別予測** を Google Colab 上のシンプルなUIとして提供するスクリプトの解説です。  
論文中で提示した「実運用を想定した予測アプリ」の実装に対応します。

---

# A病院 予測UIスクリプト：概要サマリー

---

## 1. 日次予測UI
> **目的**: 1日の**総採血患者数**を予測するための、シンプルな対話形式UIを提供する。

### ⚙️ 処理フロー
1.  **Googleドライブ連携**: 実行環境をGoogleドライブに接続する。
2.  **モデル読込**: 事前に学習したA病院用の**日次予測モデル** (`model_A_daily.json`) とスケーラー (`model_A_daily_scaler.joblib`) を読み込む。
3.  **ユーザー入力**:
    * `予測日`: 日付をカレンダーから選択。
    * `延べ外来患者数`: その日の外来患者数の見込み値を入力。
    * `天気`: 予報を選択。
4.  **予測実行**:
    * 入力値から、学習時と同じ日次特徴量（曜日、週回数など）を自動生成する。
    * 読み込んだモデルを使い、指定した**1日分**の採血患者数を予測する。
5.  **結果表示**:
    * 予測された患者数を画面に表示する。

### ✨ 特徴
* 特定の日付をピンポイントで予測するための基本的なUI。

---

## 2. 時間帯別予測UI
> **目的**: 1日の中の**30分単位の採血患者数**を予測し、スケジュールを可視化するための高機能なUIを提供する。

### ⚙️ 処理フロー
1.  **Googleドライブ連携**: 実行環境をGoogleドライブに接続する。
2.  **モデル読込**: 事前に学習したA病院用の**時間帯別予測モデル** (`model_A_timeseries_lag_stable.json`) と特徴量リスト (`columns_A_timeseries_lag_stable.json`) を読み込む。
3.  **ユーザー入力**:
    * `予測対象日`: 日付をカレンダーから選択。
    * `延べ外来患者数`: その日の**1日合計**の外来患者数の見込み値を入力。
    * `天気予報`: 予報を選択。
4.  **予測実行（逐次予測）**:
    * 8:00から18:00までの30分枠を順番にループ処理する。
    * ある時間帯（例: 9:00）を予測する際、直前の時間帯（例: 8:30）の**予測結果をラグ特徴量として利用**する。
    * これを繰り返すことで、1日の連続した混雑の波をシミュレートする。
5.  **結果表示**:
    * 予測結果を**グラフ**と**一覧表（テーブル形式）**でまとめて表示する。

### ✨ 特徴
* 1日の全体状況から、30分毎の詳細な業務量を予測できる。
* ラグ特徴量を活用した、より現実に近い逐次予測モデル。
* 結果が可視化されるため、直感的に混雑状況を把握できる。

## 主な機能

- 日次の総採血患者数予測（単日）  
- 5営業日連続の採血患者数予測（休日スキップ）  
- 1日を30分単位に分割した時間帯別混雑予測（ラグ特徴量利用）  

いずれも、**A病院用に事前学習したモデルファイル** を Google Drive から読み込み、UI から選択された日付・外来患者数・天気などを入力して予測を行います。

## 実行方法（概要）

1. Google Colab 上で `a_hospital_prediction_app.py` 相当のコードを実行。  
2. Google Drive をマウントし、モデルファイルの格納パスを指定。  
3. 画面上のフォームから、予測日・外来患者数・気象条件などを入力。  
4. 予測結果がグラフおよびテーブルとして表示されます。
